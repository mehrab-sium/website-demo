<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Guide to Skin Pigmentation & Treatments - CYNORAÂ®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@300;400;500;600;700&family=Outfit:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        html {
            scroll-behavior: smooth;
        }
        body {
            /* Updated body font to Josefin Sans */
            font-family: 'Josefin Sans', sans-serif;
            color: #D1D5DB; /* Tailwind gray-300 */
            position: relative; 
            min-height: 100vh;
            overflow-x: hidden;
            background-color: #030712; /* Tailwind gray-950 - Very dark fallback */
            -webkit-font-smoothing: antialiased; /* For smoother font rendering on WebKit */
            -moz-osx-font-smoothing: grayscale; /* For smoother font rendering on Firefox */
        }
        body::before { 
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://res.cloudinary.com/dtt3qjyc0/image/upload/w_2000,q_auto,f_auto/pawel-czerwinski-TLzxYiyXw1o-unsplash_ocgicg.jpg'); 
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            filter: blur(16px) brightness(0.7) saturate(60%);
            opacity: 0.6; 
            z-index: -1; 
        }
        
        /* Animation Keyframes */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInRight { from { opacity:0; transform: translateX(30px); } to { opacity:1; transform: translateX(0); } }
        @keyframes slideInLeft { from { opacity:0; transform: translateX(-30px); } to { opacity:1; transform: translateX(0); } }

        .initial-load-brand { animation: slideInLeft 0.8s 0.2s ease-out forwards; opacity:0; }
        .initial-load-nav-item { animation: fadeInUp 0.6s ease-out forwards; opacity:0; }
        .initial-load-cta { animation: slideInRight 0.8s 0.2s ease-out forwards; opacity:0; }
        .scroll-fade-in { opacity: 0; transform: translateY(40px); transition: opacity 0.7s ease-out, transform 0.7s ease-out; }
        .scroll-fade-in.visible { opacity: 1; transform: translateY(0); }

        /* Navigation Styling */
        nav {
            background-color: rgba(20, 22, 25, 0.6); 
            backdrop-filter: blur(18px) saturate(100%); 
            -webkit-backdrop-filter: blur(18px) saturate(100%); 
            border-bottom: 1px solid rgba(200, 200, 200, 0.07); 
            padding: 0.75rem 0; /* Adjusted padding for a sleeker nav */
            position: fixed; 
            top: 0; left: 0; right: 0; width: 100%;
            z-index: 50; 
            transition: background-color 0.3s ease; /* Smooth transition for nav bg if it changes */
        }
        
        .brand-in-nav {
            font-size: 1.3rem; /* Slightly adjusted size */
            color: #F3F4F6; 
            letter-spacing: 0.03em;
            transition: transform 0.3s ease; /* Smooth transform on hover */
        }
        .brand-in-nav:hover {
            transform: scale(1.02); /* Subtle scale effect */
        }
        .brand-in-nav.helvetica-neue-cynora {
            font-family: "Helvetica Neue", 'Poppins', sans-serif; 
            font-weight: normal; 
        }
        .brand-in-nav.helvetica-neue-cynora .reg-symbol {
            font-size: 0.6em; vertical-align: super; font-weight: 400; 
            letter-spacing: normal; display: inline-block; line-height: 1; 
        }

        .nav-button {
            /* Updated nav button font to Outfit */
            font-family: 'Outfit', sans-serif;
            padding: 0.5rem 1rem; /* Adjusted padding */
            border-radius: 0.375rem; 
            transition: color 0.3s ease, transform 0.2s ease; /* Added ease to transitions */
            cursor: pointer; font-weight: 500; font-size: 0.95rem; /* Adjusted font size */
            color: #CBD5E1; /* Tailwind slate-300, slightly lighter for better contrast */
            white-space: nowrap; position: relative;
        }
        .nav-button::after { 
            content: ''; position: absolute; width: 0; height: 2px;
            bottom: -4px; /* Adjusted position */
            left: 50%; transform: translateX(-50%);
            background-color: #6EE7B7; 
            transition: width 0.3s ease-in-out;
        }
        .nav-button:hover::after, .nav-button.active::after { width: 60%; } /* Slightly reduced underline width */
        .nav-button:hover { color: #F8FAFC; transform: translateY(-1px); } /* Tailwind slate-50, subtle lift */
        .nav-button.active { color: #FFFFFF; font-weight: 600; } /* White for active */
        
        .cta-button {
            /* Updated CTA button font to Outfit */
            font-family: 'Outfit', sans-serif;
            padding: 0.5rem 1.1rem; /* Adjusted padding */
            border-radius: 0.375rem;
            font-weight: 600; font-size: 0.95rem; color: #F9FAFB; 
            background-color: rgba(56, 189, 248, 0.2); /* Tailwind sky-400 with alpha */
            border: 1px solid rgba(56, 189, 248, 0.5); /* Subtle border */
            transition: all 0.3s ease-in-out;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3); /* Softer shadow */
            white-space: nowrap;
        }
        .cta-button:hover {
            background-color: rgba(56, 189, 248, 0.3); 
            border-color: rgba(56, 189, 248, 0.7);
            transform: translateY(-1px) scale(1.03);
            box-shadow: 0 3px 8px rgba(56, 189, 248, 0.2); /* Enhanced shadow on hover */
        }

        #mobile-menu-panel {
            background-color: rgba(20, 22, 25, 0.75); 
            backdrop-filter: blur(18px) saturate(100%); -webkit-backdrop-filter: blur(18px) saturate(100%);
            border-top: 1px solid rgba(200, 200, 200, 0.07); 
            position: absolute; left:0; right:0; top: 100%; z-index: 45; 
        }
        #mobile-menu-panel .nav-button {
            /* Ensure mobile nav buttons also use Outfit */
            font-family: 'Outfit', sans-serif;
            display: block; width: 100%; text-align: center; 
            padding: 1rem 1.5rem; font-size: 1.1rem; color: #CBD5E1; border-radius: 0; 
        }
        #mobile-menu-panel .nav-button.active { background-color: rgba(55, 65, 81, 0.3); color: #F9FAFB; }
        #mobile-menu-panel .nav-button:hover { background-color: rgba(75, 85, 99, 0.2); color: #F9FAFB; }

        /* Main Content Sections - Single Glass Panel */
        #home.hero-landing-content, .content-section { 
            background-color: rgba(20, 22, 25, 0.5); 
            backdrop-filter: blur(22px) saturate(100%); 
            -webkit-backdrop-filter: blur(22px) saturate(100%);
            border: 1px solid rgba(200, 200, 200, 0.07); 
            border-radius: 0.75rem; 
            box-shadow: 0 15px 45px rgba(0, 0, 0, 0.65); 
            transition: transform 0.4s ease-out, box-shadow 0.4s ease-out; /* Smooth transition for sections */
        }
        #home.hero-landing-content:hover, .content-section:hover {
            /* Subtle lift effect on section hover - optional */
            /* transform: translateY(-3px); */
            /* box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7); */
        }

        #home.hero-landing-content { 
            padding: 7rem 1.5rem 5rem; /* Adjusted padding */
            text-align: center; 
            margin: 0 auto 2.5rem auto; /* Adjusted margin */
            max-width: 95%; /* Slightly wider for better fit */
        }
        @media (min-width: 768px) {
             #home.hero-landing-content { padding: 8rem 2rem 6rem; max-width: 90%;}
        }
         @media (min-width: 1024px) {
             #home.hero-landing-content { padding: 9rem 2rem 7rem; max-width: 85%;}
        }


        .content-section { 
            display: none; 
            padding: 2rem; /* Base padding */
            margin-bottom: 2.5rem; /* Base margin */
            opacity: 0; 
            color: #D1D5DB; 
        }
        @media (min-width: 768px) { .content-section { padding: 3rem; margin-bottom: 3rem; } }
        @media (min-width: 1024px) { .content-section { padding: 3.5rem; margin-bottom: 3.5rem; } }


        .content-section.active { display: block; opacity: 1; }
        
        /* Responsive Typography for Headings */
        #home.hero-landing-content h1 { 
            color: #F3F4F6; font-weight: 700; /* Josefin Sans bold */
            font-size: 2.25rem; /* Base for mobile */
            line-height: 1.2; margin-bottom: 1.25rem; 
            transition: font-size 0.3s ease;
        }
        #home.hero-landing-content p { 
            color: #A0AEC0; 
            font-size: 1.05rem; /* Base for mobile */
            max-width: 40rem; margin-left: auto; margin-right: auto; 
            line-height: 1.7;
            transition: font-size 0.3s ease;
        }

        @media (min-width: 640px) { /* sm */
            #home.hero-landing-content h1 { font-size: 2.75rem; }
            #home.hero-landing-content p { font-size: 1.1rem; }
        }
        @media (min-width: 768px) { /* md */
            #home.hero-landing-content h1 { font-size: 3.25rem; }
            #home.hero-landing-content p { font-size: 1.15rem; max-width: 42rem; }
        }
        @media (min-width: 1024px) { /* lg */
            #home.hero-landing-content h1 { font-size: 3.75rem; }
            #home.hero-landing-content p { font-size: 1.25rem; max-width: 45rem; }
        }
        
        .content-section h2 { 
            color: #E5E7EB; font-size: 1.75rem; margin-bottom: 1.25rem; font-weight: 600; /* Josefin Sans semibold */
            line-height: 1.3; transition: font-size 0.3s ease;
        }
        .content-section h3 { 
            color: #E5E7EB; font-size: 1.4rem; margin-top: 1.75rem; margin-bottom: 1rem; font-weight: 600; 
            line-height: 1.3; transition: font-size 0.3s ease;
        }
        .content-section h4 { 
            color: #E5E7EB; font-size: 1.15rem; margin-top: 1.5rem; margin-bottom: 0.75rem; font-weight: 500; /* Josefin Sans medium */
            line-height: 1.4; transition: font-size 0.3s ease;
        }
        .content-section p, .content-section li { 
            margin-bottom: 0.85rem; line-height: 1.8; font-weight: 400; /* Josefin Sans normal */
            font-size: 1rem; /* Base paragraph size */
            transition: font-size 0.3s ease;
        }

        @media (min-width: 768px) {
            .content-section h2 { font-size: 2rem; margin-bottom: 1.5rem; }
            .content-section h3 { font-size: 1.6rem; margin-top: 2rem; }
            .content-section h4 { font-size: 1.25rem; }
            .content-section p, .content-section li { font-size: 1.05rem; }
        }
         @media (min-width: 1024px) {
            .content-section h2 { font-size: 2.25rem; }
            .content-section h3 { font-size: 1.75rem; }
            .content-section h4 { font-size: 1.35rem; }
            .content-section p, .content-section li { font-size: 1.1rem; }
        }


        .content-section strong { color: #F3F4F6; font-weight: 600; } 
        .content-section ul { list-style-type: disc; margin-left: 1.5rem; padding-left: 0.5rem;}
        .content-section ol { list-style-type: decimal; margin-left: 1.5rem; padding-left: 0.5rem;}

        .skin-layer-diagram, #ingredientDetail, .chart-container,
        #combinations > div:not(.overflow-x-auto), 
        #combinations .grid > div, 
        #aiRoutineResult { 
            background-color: transparent !important;
            border: none !important;
            box-shadow: none !important;
            padding: 0 !important; 
            margin-top: 1.5rem; 
        }
        .skin-layer-diagram div { 
             border: 1px solid rgba(107, 114, 128, 0.15); 
             color: #9CA3AF;
             padding: 0.5rem; margin-bottom: 0.25rem;
             border-radius: 0.25rem; /* Subtle rounding */
        }
        #ingredientDetail > h3 { margin-top: 0; } 
        .chart-container { min-height: 300px; max-height: 350px; /* Adjusted for responsiveness */ }
        @media (min-width: 768px) { .chart-container { min-height: 350px; max-height: 400px; } }
        .chart-container canvas { margin-top: 1rem; width: 100% !important; height: auto !important; } 

        .ingredient-button {
            background-color: rgba(55, 65, 81, 0.25); /* Tailwind gray-700 with alpha */
            color: #CBD5E1; /* slate-300 */
            border: 1px solid rgba(107, 114, 128, 0.2); /* gray-500 with alpha */
            font-weight: 500; /* Josefin Sans medium */
            font-size: 0.9rem; /* Adjusted size */
            transition: all 0.25s ease-out; /* Smoother transition */
        }
        .ingredient-button:hover {
            background-color: rgba(71, 85, 105, 0.4); /* Tailwind slate-600 with alpha */
            border-color: #94A3B8; /* slate-400 */
            color: #F1F5F9; /* slate-100 */
            transform: translateY(-1px);
        }
        .ingredient-button.selected {
            background-color: rgba(76, 145, 170, 0.5); /* Custom tealish color */
            color: #FFFFFF; border-color: rgba(76, 145, 170, 0.7);
            font-weight: 600; /* Josefin Sans semibold */
            box-shadow: 0 0 10px rgba(76, 145, 170, 0.3); /* Subtle glow */
        }
        .tab-button {
            background-color: transparent; color: #9CA3AF; 
            border-color: transparent; 
            border-bottom: 2px solid transparent; 
            padding-bottom: 0.5rem; margin-right: 0.5rem;
            transition: color 0.3s ease, border-color 0.3s ease; /* Added ease */
            font-weight: 500; /* Josefin Sans medium */
            font-size: 0.95rem; /* Adjusted size */
        }
        .tab-button.active {
            color: #E5E7EB; 
            border-bottom-color: #6EE7B7; 
            font-weight: 600; /* Josefin Sans semibold */
        }
        .tab-content { 
            background-color: transparent;
            border: none;
            padding-top: 1rem; 
        }
        
        table { margin-top: 1.5rem; width: 100%; border-collapse: collapse;}
        th, td {
            border: 1px solid rgba(55, 65, 81, 0.2); 
            padding: 0.75rem; text-align: left; color: #D1D5DB; 
            font-weight: 400; 
            font-size: 0.95rem; /* Adjusted for Josefin Sans */
        }
        th {
            background-color: rgba(55, 65, 81, 0.15); 
            color: #E5E7EB; font-weight: 600; /* Josefin Sans semibold */
            font-size: 1rem; /* Adjusted */
        }
        .glossary-term { color: #6EE7B7; font-weight: 600; } 

        #aiHelper label { color: #CBD5E1; font-weight: 500; font-size: 0.95rem; } 
        #aiHelper select, #aiHelper input[type="text"] {
            background-color: rgba(31, 41, 55, 0.4); 
            color: #E5E7EB; border: 1px solid rgba(107, 114, 128, 0.2); 
            font-weight: 400; 
            font-size: 0.95rem; /* Ensure consistent font size */
            padding: 0.6rem 0.75rem; /* Adjusted padding */
        }
        #aiHelper select option { background-color: #111827; color: #E5E7EB; } 
        #aiHelper input[type="text"]::placeholder { color: #6B7280; } 
        
        #getAIRoutineBtn {
            background-color: rgba(56, 189, 248, 0.25); /* Tailwind sky-400 with alpha */
            border: 1px solid rgba(56, 189, 248, 0.5);
            color: #F9FAFB;
            font-weight: 600; /* Josefin Sans semibold */
            font-size: 1rem; /* Adjusted */
            padding: 0.6rem 1.25rem; /* Adjusted */
            transition: all 0.3s ease; /* Added ease */
        }
        #getAIRoutineBtn:hover {
             background-color: rgba(56, 189, 248, 0.35); 
             border-color: rgba(56, 189, 248, 0.7);
             transform: translateY(-1px) scale(1.02); /* More subtle scale */
        }
        
        footer {
            background-color: rgba(10, 10, 15, 0.5); 
            border-top: 1px solid rgba(55, 65, 81, 0.1); 
            padding: 2rem 1rem; /* Added padding */
        }
        footer p { color: #9CA3AF; font-weight: 400; font-size: 0.9rem; } /* Adjusted size */

        .modal {
            display: none; position: fixed; z-index: 1000; 
            left: 0; top: 0; width: 100%; height: 100%;
            overflow: auto; background-color: rgba(0,0,0,0.85); 
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            transition: opacity 0.3s ease; /* Smooth modal fade */
        }
        .modal-content {
            background-color: rgba(20, 22, 25, 0.7); 
            backdrop-filter: blur(20px) saturate(100%); 
            -webkit-backdrop-filter: blur(20px) saturate(100%);
            margin: 8% auto; /* Adjusted margin for better centering */
            padding: 2rem; /* Adjusted padding */
            border: 1px solid rgba(156, 163, 175, 0.08); 
            border-radius: 0.75rem; width: 90%; max-width: 600px; /* Adjusted max-width */
            color: #D1D5DB; box-shadow: 0 10px 30px rgba(0,0,0,0.7);
            transform: scale(0.95); /* Initial state for pop animation */
            opacity: 0; /* Initial state for fade animation */
            transition: transform 0.3s ease-out, opacity 0.3s ease-out; /* Smooth pop and fade */
        }
        .modal.active .modal-content { /* For JS to trigger animation */
            transform: scale(1);
            opacity: 1;
        }

        .modal-content h2 { color: #E5E7EB; margin-bottom: 1.5rem; font-size: 1.5rem; font-weight: 600;} /* Adjusted */
        .modal-content label { color: #CBD5E1; margin-bottom: 0.5rem; display: block; font-weight: 500; font-size: 0.9rem;} /* Adjusted */
        .modal-content select, .modal-content input[type="text"], .modal-content textarea {
            width: 100%; padding: 0.6rem 0.75rem; margin-bottom: 1rem; /* Adjusted */
            border-radius: 0.375rem; border: 1px solid rgba(107, 114, 128, 0.2);
            background-color: rgba(31, 41, 55, 0.5); color: #E5E7EB;
            transition: border-color 0.3s ease, box-shadow 0.3s ease; /* Added ease */
            font-weight: 400; font-size: 0.9rem; /* Adjusted */
        }
        .modal-content select:focus, .modal-content input[type="text"]:focus, .modal-content textarea:focus {
            outline: none; border-color: #60A5FA; /* Tailwind blue-400 */
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.3); /* Tailwind blue-400 with alpha */
        }
        .modal-content button[type="submit"] {
            background-color: rgba(56, 189, 248, 0.3); /* Tailwind sky-400 with alpha */
            border: 1px solid rgba(56, 189, 248, 0.6);
            color: white; padding: 0.6rem 1.25rem; /* Adjusted */
            border: none; border-radius: 0.375rem;
            cursor: pointer; transition: all 0.3s ease; font-weight: 600; /* Josefin Sans semibold */
            font-size: 0.95rem; /* Adjusted */
        }
        .modal-content button[type="submit"]:hover {
            background-color: rgba(56, 189, 248, 0.4); 
            border-color: rgba(56, 189, 248, 0.8);
            transform: translateY(-1px);
        }
        .close-btn {
            color: #9CA3AF; float: right; font-size: 2rem; /* Increased size */
            font-weight: 300; /* Lighter weight for a softer look */
            transition: color 0.3s ease, transform 0.3s ease; /* Added transform transition */
            line-height: 1; /* Ensure it doesn't affect layout */
        }
        .close-btn:hover, .close-btn:focus { color: #E5E7EB; text-decoration: none; cursor: pointer; transform: rotate(90deg); }
        
        #recommendation-output {
            margin-top: 1.5rem; padding: 1rem;
            background-color: rgba(31, 41, 55, 0.25); 
            border-radius: 0.375rem; border: 1px solid rgba(107, 114, 128, 0.08);
            color: #E5E7EB;
            font-size: 0.95rem; /* Consistent font size */
        }
        #recommendation-output h3 { color: #CBD5E1; margin-bottom: 0.75rem; font-size: 1.15rem; font-weight: 600;} 
        #recommendation-output p { margin-bottom: 0.75rem; line-height: 1.7; font-weight: 400;} 
        #recommendation-output ul { list-style-position: inside; margin-left: 0.5rem; margin-bottom: 0.75rem; }
        #recommendation-output li { margin-bottom: 0.5rem; line-height: 1.7; font-weight: 400;} 
        
         #aiRoutineResult h4 { color: #E5E7EB; font-weight: 600; font-size: 1.25rem; } /* Adjusted */
         #aiRoutineResult h5 { color: #D1D5DB; font-weight: 500; font-size: 1.1rem; } /* Adjusted */
         #aiRoutineResult p, #aiRoutineResult li { color: #D1D5DB; font-weight: 400; font-size: 1rem; } /* Adjusted */
         #aiRoutineResult strong { color: #E5E7EB; font-weight: 600; } 

    </style>
</head>
<body class="text-base leading-relaxed">
    
    <nav> 
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center h-full">
            <div class="brand-in-nav initial-load-brand helvetica-neue-cynora">
                <span class="font-light">C</span><span class="font-medium">Y</span><span class="font-semibold">N</span><span class="font-bold">ORA</span><sup class="reg-symbol">&reg;</sup>
            </div>
            
            <div id="desktop-nav-links" class="hidden md:flex items-center space-x-1 initial-load-nav">
                <a href="#home" class="nav-button active" data-target="home" style="animation-delay: 0.2s;">Home</a>
                <a href="#understanding" class="nav-button" data-target="understanding" style="animation-delay: 0.3s;">Understanding</a>
                <a href="#ingredients" class="nav-button" data-target="ingredients" style="animation-delay: 0.4s;">Ingredients</a>
                <a href="#combinations" class="nav-button" data-target="combinations" style="animation-delay: 0.5s;">Combinations</a>
                <a href="#aiHelper" class="nav-button" data-target="aiHelper" style="animation-delay: 0.6s;">â¨ AI Helper</a>
                <a href="#glossary" class="nav-button" data-target="glossary" style="animation-delay: 0.7s;">Glossary</a>
            </div>
            
            <a href="#" class="cta-button initial-load-cta hidden sm:inline-block" id="get-started-btn" style="animation-delay: 0.2s;">Get Started</a>

            <div class="md:hidden flex items-center">
                <button id="burger-menu-button" aria-label="Open menu" class="text-gray-300 hover:text-white focus:outline-none p-2 rounded-md transition-colors duration-200 hover:bg-gray-700/50">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                    </svg>
                </button>
            </div>
        </div>
        <div id="mobile-menu-panel" class="hidden md:hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#home" class="nav-button active" data-target="home">Home</a>
                <a href="#understanding" class="nav-button" data-target="understanding">Understanding</a>
                <a href="#ingredients" class="nav-button" data-target="ingredients">Ingredients</a>
                <a href="#combinations" class="nav-button" data-target="combinations">Combinations</a>
                <a href="#aiHelper" class="nav-button" data-target="aiHelper">â¨ AI Helper</a>
                <a href="#glossary" class="nav-button" data-target="glossary">Glossary</a>
                <a href="#" class="nav-button sm:hidden" id="get-started-btn-mobile">Get Started</a>
            </div>
        </div>
    </nav>

    <main> 
        <section id="home" class="hero-landing-content content-section active scroll-fade-in">
            <h1 class="initial-load-brand" style="animation-delay: 0.4s;">Interactive Guide to Skin Pigmentation & Treatments</h1>
            <p class="initial-load-brand" style="animation-delay: 0.6s;">An exploration of dermatological science behind skin color and its management.</p>
        </section>

        <div class="container mx-auto p-4 sm:p-6 lg:p-8"> <section id="understanding" class="content-section">
                <h2 class="mb-6">Understanding Pigmentation</h2> <p class="mb-6 text-lg leading-relaxed">Skin pigmentation is determined by melanin, a pigment produced by specialized cells called melanocytes. This section explores the skin's structure, how melanin is made, and common conditions that lead to changes in skin color. Gaining clarity on these foundational topics is crucial for appreciating how different treatments work to address pigmentation concerns.</p>
                
                <h3 class="mb-3">A. Fundamental Skin Anatomy & Physiology</h3>
                <p class="mb-3">The skin, our largest organ, has three main layers: the epidermis, dermis, and hypodermis. Pigmentation primarily involves the epidermis and dermis.</p>
                <div class="skin-layer-diagram my-5"> 
                    <div class="epidermis"><b>Epidermis</b> (Outermost layer)</div>
                    <div class="dermis"><b>Dermis</b> (Middle layer)</div>
                    <div class="hypodermis"><b>Hypodermis</b> (Innermost layer)</div>
                </div>
                <p class="mb-3">The <strong>Epidermal Melanin Unit</strong> consists of one melanocyte supplying melanin to about 30-40 keratinocytes. This ensures even pigment distribution. Melanocytes are located in the basal layer of the epidermis.</p>
                
                <h3 class="mb-3 mt-8">B. The Process of Melanogenesis (Melanin Production)</h3>
                <p class="mb-3">Melanogenesis is the complex process of producing melanin within melanosomes (organelles inside melanocytes).</p>
                <ol class="list-decimal list-inside space-y-2">
                    <li><strong>Origin:</strong> Melanocytes originate from neural crest cells and migrate to the epidermis.</li>
                    <li><strong>Melanosome Maturation:</strong> Melanin is synthesized in stages (I-IV) within melanosomes.</li>
                    <li><strong>Enzymatic Cascade:</strong>
                        <ul class="list-disc list-inside ml-5 space-y-1">
                            <li>L-Tyrosine is converted to L-DOPA by the enzyme <strong>Tyrosinase</strong> (rate-limiting step).</li>
                            <li>Tyrosinase further oxidizes L-DOPA to Dopaquinone.</li>
                            <li>Dopaquinone leads to <strong>Eumelanin</strong> (brown/black) or, with cysteine, <strong>Pheomelanin</strong> (red/yellow).</li>
                        </ul>
                    </li>
                    <li><strong>Key Enzymes:</strong> Tyrosinase (TYR), Tyrosinase-Related Protein 1 (TYRP1), Dopachrome Tautomerase (DCT).</li>
                    <li><strong>Melanosome Transfer:</strong> Mature melanosomes are transferred from melanocytes to keratinocytes.</li>
                </ol>
                <p class="mt-3 mb-3"><strong>Regulation:</strong> Melanogenesis is regulated by genetics, hormones, UV radiation (most potent stimulator), and inflammation.</p>
                <p class="italic">UV radiation triggers DNA damage, p53 activation, release of signaling molecules, and enzyme activation, all increasing melanin production.</p>
                
                <h3 class="mb-5 mt-8">C. Common Types of Persistent Skin Pigmentation</h3>
                 <div class="flex flex-wrap border-b border-gray-700/30 mb-4"> 
                    <button class="tab-button active" onclick="openDisorderTab(event, 'melasma')">Melasma</button>
                    <button class="tab-button" onclick="openDisorderTab(event, 'pih')">Post-Inflammatory Hyperpigmentation (PIH)</button>
                    <button class="tab-button" onclick="openDisorderTab(event, 'lentigines')">Solar Lentigines</button>
                </div>
                <div id="melasma" class="tab-content active">
                    <h4 class="mb-2">Melasma</h4>
                    <p class="mb-2"><strong>Presentation:</strong> Symmetrical, irregular brown/gray-brown patches on sun-exposed areas.</p>
                    <p class="mb-2"><strong>Pathophysiology:</strong> Multifactorial. Key factors include UV Radiation, Hormonal Factors, Genetic Predisposition, and Dermal Factors.</p>
                    <p><strong>Types:</strong> Epidermal, Dermal, Mixed.</p>
                </div>
                <div id="pih" class="tab-content">
                    <h4 class="mb-2">Post-Inflammatory Hyperpigmentation (PIH)</h4>
                    <p class="mb-2"><strong>Presentation:</strong> Light brown to blue-gray macules/patches after skin inflammation or injury.</p>
                    <p class="mb-2"><strong>Etiology:</strong> Acne, eczema, psoriasis, trauma, dermatological procedures.</p>
                    <p class="mb-2"><strong>Pathogenesis:</strong> Inflammatory mediators stimulate melanocytes. Dermal PIH is more persistent.</p>
                    <p><strong>Risk Factors:</strong> More common in darker skin types. Intensity of initial inflammation matters.</p>
                </div>
                <div id="lentigines" class="tab-content">
                    <h4 class="mb-2">Solar Lentigines (Sun Spots)</h4>
                    <p class="mb-2"><strong>Presentation:</strong> Benign, discrete tan to dark brown macules on chronically sun-exposed skin.</p>
                    <p class="mb-2"><strong>Pathogenesis:</strong> Chronic UV exposure leads to localized melanocyte proliferation and melanin accumulation.</p>
                    <p><strong>Risk Factors:</strong> Age, fair skin, cumulative sun exposure.</p>
                </div>
            </section>

            <section id="ingredients" class="content-section">
                <h2 class="mb-6">Active Ingredients for Hyperpigmentation</h2>
                <p class="mb-6 text-lg leading-relaxed">A variety of active ingredients are scientifically recognized for their ability to treat persistent skin pigmentation. They work through different mechanisms, such as inhibiting the pigment-producing enzyme tyrosinase, accelerating skin cell turnover, or preventing pigment transfer. This section allows you to explore these key ingredients in detail. Click on an ingredient name to learn more about its specific actions, chemical properties, efficacy from studies, and clinical profile.</p>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 sm:gap-4 mb-8" id="ingredientButtons"> </div>
                <div id="ingredientDetail" class="min-h-[200px]"> 
                    <p class="text-gray-400 italic">Select an ingredient from the list above to view its details.</p>
                </div>
                
                <h3 class="mb-3 mt-8">Tyrosinase Inhibitor Potency Comparison</h3>
                <p class="mb-5 text-lg leading-relaxed">Some ingredients are particularly effective at inhibiting tyrosinase, the key enzyme in melanin production. The chart below compares the approximate half-maximal inhibitory concentration ($IC_{50}$) of selected agents against human tyrosinase. A lower $IC_{50}$ value indicates greater potency.</p>
                <div class="chart-container"> 
                    <canvas id="potencyChart"></canvas>
                </div>
                 <p class="text-sm text-gray-400 mt-3 text-center">Data based on reported $IC_{50}$ values: Thiamidol ~1.1 Âµmol/L, Hydroquinone >4000 Âµmol/L, Kojic Acid >500 Âµmol/L for human tyrosinase. This illustrates Thiamidol's high specific potency.</p>
            </section>

            <section id="combinations" class="content-section">
                <h2 class="mb-6">Ingredient Combinations & Skin Type Considerations</h2>
                <p class="mb-6 text-lg leading-relaxed">Treating hyperpigmentation often involves a multi-faceted approach. Combining active ingredients with different mechanisms of action can enhance efficacy. However, it's also crucial to consider how these ingredients and combinations interact with various skin types and tones, as sensitivity and response can vary significantly. This section provides an overview of these important aspects.</p>
                
                <h3 class="mb-3">Synergistic Effects of Combining Ingredients</h3>
                <p class="mb-3">Combining ingredients that target different steps in the pigmentation pathway can lead to better and faster results.</p>
                <p class="mb-3"><strong>Pros of Combinations:</strong></p>
                <ul class="list-disc list-inside ml-4 mb-3 space-y-1.5">
                    <li><strong>Enhanced Efficacy:</strong> Targeting multiple pathways can be more effective.</li>
                    <li><strong>Reduced Concentrations:</strong> May allow lower doses, reducing side effects.</li>
                    <li><strong>Addressing Multiple Factors:</strong> Useful for complex conditions like melasma.</li>
                </ul>
                <p class="mb-3"><strong>Common Effective Combinations (Examples):</strong></p>
                <ul class="list-disc list-inside ml-4 mb-3 space-y-1.5">
                    <li><strong>Kligman's Formula:</strong> Hydroquinone + Retinoid + Mild Corticosteroid.</li>
                    <li><strong>Retinoids + Tyrosinase Inhibitors:</strong> e.g., Retinoid + Azelaic Acid.</li>
                    <li><strong>Niacinamide + Various Actives:</strong> Good partner due to barrier support.</li>
                </ul>
                 <p class="mb-2"><strong>Cons of Combinations:</strong></p>
                <ul class="list-disc list-inside ml-4 mb-8">
                    <li><strong>Increased Irritation Potential:</strong> Requires careful introduction.</li>
                </ul>
                
                <h3 class="mb-3">Facial vs. Body Application</h3>
                <ul class="list-disc list-inside ml-4 space-y-1.5 mb-8">
                    <li><strong>Skin Thickness:</strong> Body skin is thicker.</li>
                    <li><strong>Sensitivity:</strong> Facial skin often more sensitive.</li>
                    <li><strong>Area Size:</strong> Systemic absorption concern for large body areas.</li>
                </ul>
            
                <h3 class="mb-3">Skin Type & Tone Considerations</h3>
                 <ul class="list-disc list-inside ml-4 space-y-1.5 mb-8">
                    <li><strong>Sensitive/Dry Skin:</strong> Gentle actives preferred.</li>
                    <li><strong>Oily/Acne-Prone Skin:</strong> Benefits from Salicylic Acid, Retinoids.</li>
                    <li><strong>Darker Skin Tones:</strong> Higher PIH risk. Caution with aggressive treatments.</li>
                </ul>
                
                <h3 class="mb-3 mt-8">Ingredient Categorization Overview</h3>
                <p class="mb-5 text-lg leading-relaxed">This table provides a general categorization of key ingredients. Individual results can vary.</p>
                <div class="overflow-x-auto rounded-lg border border-gray-700/30"> <table>
                        <thead>
                            <tr>
                                <th>Ingredient</th>
                                <th>General Speed of Noticeable Results</th>
                                <th>Reliability (Evidence Strength)</th>
                                <th>Factors Contributing to 'Premiumness'</th>
                            </tr>
                        </thead>
                        <tbody id="categorizationTableBody">
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="aiHelper" class="content-section">
                <h2 class="mb-5">â¨ AI Skincare Helper</h2>
                <p class="mb-6 text-lg leading-relaxed">Get a personalized skincare routine suggestion from our AI! Please provide some information about your skin and concerns. This tool provides general suggestions and is not a substitute for professional dermatological advice.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"> <div>
                        <label for="aiSkinType" class="block text-sm font-medium mb-1.5">Your Skin Type:</label>
                        <select id="aiSkinType" class="mt-1 block w-full py-2 px-3 border rounded-md shadow-sm focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm bg-gray-700/50 border-gray-600/30 text-gray-200">
                            <option>Normal</option>
                            <option>Oily</option>
                            <option>Dry</option>
                            <option>Combination</option>
                            <option>Sensitive</option>
                        </select>
                    </div>
                    <div>
                        <label for="aiConcern" class="block text-sm font-medium mb-1.5">Primary Pigmentation Concern:</label>
                        <select id="aiConcern" class="mt-1 block w-full py-2 px-3 border rounded-md shadow-sm focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm bg-gray-700/50 border-gray-600/30 text-gray-200">
                            <option>General Hyperpigmentation</option>
                            <option>Melasma</option>
                            <option>Post-Inflammatory Hyperpigmentation (PIH)</option>
                            <option>Solar Lentigines (Sun Spots)</option>
                            <option>Uneven Skin Tone</option>
                        </select>
                    </div>
                </div>
                <div class="mb-6">
                    <label for="aiAvoidIngredients" class="block text-sm font-medium mb-1.5">Ingredients to avoid or currently using (optional, comma-separated):</label>
                    <input type="text" id="aiAvoidIngredients" class="mt-1 block w-full py-2 px-3 border rounded-md shadow-sm focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-sm bg-gray-700/50 border-gray-600/30 text-gray-200 placeholder-gray-500/70" placeholder="e.g., Retinol, Vitamin C">
                </div>
                <button id="getAIRoutineBtn" class="inline-flex items-center">
                    <span class="mr-2">Get AI Routine Suggestion</span>
                    <svg id="aiLoadingSpinner" class="animate-spin -ml-1 mr-2 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
                <div id="aiRoutineResult" class="mt-8 min-h-[100px] hidden"> 
                </div>
            </section>

            <section id="glossary" class="content-section">
                <h2 class="mb-6">Glossary of Dermatological Terms</h2>
                <p class="mb-6 text-lg leading-relaxed">Understanding the terminology used in dermatology is essential for grasping the nuances of skin pigmentation and its treatments. This glossary defines key terms relevant to the topics discussed in this guide. Accurate use of these terms helps in precise diagnosis, treatment selection, and communication.</p>
                <div id="glossaryContent" class="space-y-4"> </div>
            </section>
        </div>
    </main>

    <div id="get-started-modal" class="modal">
      <div class="modal-content">
        <span id="close-modal" class="close-btn">&times;</span>
        <h2>Find Your Perfect Skin Treatment</h2>
        <form id="skin-consultation-form" class="space-y-3.5"> <div>
            <label for="hyperpigmentation-type">Select Your Type of Hyperpigmentation:</label>
            <select id="hyperpigmentation-type" name="hyperpigmentation-type" class="w-full">
              <option value="melasma">Melasma</option>
              <option value="pih">Post-Inflammatory Hyperpigmentation (PIH)</option>
              <option value="solar-lentigines">Solar Lentigines (Sun Spots)</option>
              <option value="uneven-tone">Uneven Skin Tone</option>
              <option value="general">General Dark Spots</option>
              <option value="other-pigment">Other</option>
              <option value="unsure-pigment">Unsure</option>
            </select>
          </div>

          <div>
            <label for="skin-type">Skin Type (Fitzpatrick scale):</label>
            <select id="skin-type" name="skin-type" class="w-full">
              <option value="I">Type I (Very fair, always burns, never tans)</option>
              <option value="II">Type II (Fair, usually burns, tans minimally)</option>
              <option value="III">Type III (Medium, sometimes burns, tans uniformly)</option>
              <option value="IV">Type IV (Olive, rarely burns, tans well)</option>
              <option value="V">Type V (Brown, very rarely burns, tans very easily)</option>
              <option value="VI">Type VI (Dark brown/black, never burns, tans very easily)</option>
              <option value="unsure-fitzpatrick">Unsure</option>
            </select>
          </div>

          <div>
            <label for="sensitivity">Any skin sensitivity?</label>
            <select id="sensitivity" name="sensitivity" class="w-full">
                <option value="none">None</option>
                <option value="mild-redness">Mild redness/itching occasionally</option>
                <option value="eczema-prone">Eczema prone</option>
                <option value="rosacea-prone">Rosacea prone</option>
                <option value="retinoid-sensitive">Sensitive to Retinoids</option>
                <option value="aha-bha-sensitive">Sensitive to AHAs/BHAs</option>
                <option value="fragrance-sensitive">Sensitive to Fragrance</option>
                <option value="other-sensitivity">Other (Specify if comfortable in notes)</option>
                <option value="unsure-sensitivity">Unsure about sensitivity</option>
            </select>
          </div>

          <div>
            <label for="current-routine">Current key active ingredients in your routine:</label>
             <select id="current-routine" name="current-routine" class="w-full">
                <option value="none">None / Basic (Cleanser, Moisturizer, SPF)</option>
                <option value="retinoids">Retinoids (Retinol, Tretinoin, Adapalene)</option>
                <option value="vitamin-c">Vitamin C</option>
                <option value="ahas">AHAs (Glycolic, Lactic Acid)</option>
                <option value="bhas">BHAs (Salicylic Acid)</option>
                <option value="niacinamide">Niacinamide</option>
                <option value="azelaic-acid">Azelaic Acid</option>
                <option value="hydroquinone">Hydroquinone</option>
                <option value="multiple-actives">Multiple Actives (e.g., Retinoid + Vit C)</option>
                <option value="other-actives">Other Actives (Specify if comfortable in notes)</option>
            </select>
          </div>
          
          <div>
            <label for="medical-history">Any relevant medical history or medications?</label>
            <select id="medical-history" name="medical-history" class="w-full">
                <option value="none">None</option>
                <option value="allergies">Known Skin Allergies</option>
                <option value="topical-meds">Using Prescription Topical Medications</option>
                <option value="oral-meds">Taking Oral Medications for Skin/Other</option>
                <option value="pregnant-nursing">Pregnant or Nursing</option>
                <option value="prefer-not-to-say">Prefer not to say</option>
            </select>
          </div>

          <button type="submit" id="submit-form-btn">Get Recommendations</button>
        </form>
        <div id="recommendation-output" class="mt-4"></div>
      </div>
    </div>


    <footer class="text-center py-8 mt-10"> <p>&copy; 2025 Skin Pigmentation Guide: Dermatology-based, AI suggestions are informational, not medical advice.</p>
    </footer>

<script>
    // Ingredient and Glossary data remains the same as previous version
    const ingredientData = {
        "Hydroquinone": {
            mechanism: [
                "Competitively inhibits tyrosinase, the rate-limiting enzyme in melanin synthesis.",
                "Exhibits cytotoxic effects on melanocytes, leading to their damage and reduced numbers.",
                "May inhibit DNA/RNA synthesis in melanocytes and alter melanosome structure."
            ],
            chemical: [
                "Benzene-1,4-diol, aromatic organic compound.",
                "Susceptible to oxidation (turns brown/black); requires light/air protection and stabilizers (e.g., sodium metabisulfite).",
                "Penetration enhanced by retinoids or AHAs; liposomal encapsulation can improve delivery."
            ],
            efficacy: "Long considered a benchmark for hyperpigmentation, especially melasma. Dual action of tyrosinase inhibition and melanocytotoxicity leads to significant depigmentation. Efficacy often seen within 4-6 weeks, more significant results in 2-3 months.",
            clinical: {
                indications: "Melasma, severe PIH, solar lentigines.",
                side_effects: "Irritation, redness, dryness, contact dermatitis. Rare but serious: exogenous ochronosis (paradoxical blue-black discoloration) with prolonged use/high concentrations, especially in darker skin. Hypopigmentation.",
                contraindications: "Pregnancy, lactation (generally). Allergy to HQ.",
                safety: "Often used short-term (3-6 months) under medical supervision. Gradual tapering recommended. Strict sun protection is mandatory."
            },
            speed: "Noticeable in 4-6 weeks, significant in 2-3 months.",
            reliability: "High (for efficacy, but with safety caveats).",
            premiumness: "Formulation for stability, potential for controlled release systems (liposomes)."
        },
        "Retinoids": {
            mechanism: [
                "Accelerate epidermal cell turnover, shedding pigmented keratinocytes.",
                "Inhibit tyrosinase activity and expression.",
                "Promote melanin dispersion and reduce melanosome transfer.",
                "Downregulate melanocyte activity.",
                "Receptor-mediated action (RARs, RXRs) modulating gene transcription."
            ],
            chemical: [
                "Vitamin A derivatives (Tretinoin, Retinol, Adapalene, Tazarotene).",
                "Lipophilic. Many are unstable (light, oxygen, heat sensitive - e.g., Tretinoin, Retinol).",
                "Adapalene is more stable. Tazarotene is a prodrug.",
                "Advanced formulations (microspheres, nanoemulsions, SLNs) improve stability, delivery, and reduce irritation."
            ],
            efficacy: "Highly effective for various hyperpigmentation types and photoaging. Tretinoin is potent. Results are gradual, noticeable over weeks to months. Improves skin texture and tone.",
            clinical: {
                indications: "Melasma, PIH (especially acne-induced), solar lentigines, photoaging.",
                side_effects: "Common: Retinoid dermatitis (irritation, redness, peeling, dryness, sun sensitivity). Usually improves with time and proper use (gradual introduction, moisturizers).",
                contraindications: "Pregnancy (teratogenic risk, especially oral and high-potency topicals like Tazarotene).",
                safety: "Start with low concentration, infrequent application. Sun protection is critical. Not all retinoids are equal in potency/irritation."
            },
            speed: "Gradual; weeks to months for visible improvement.",
            reliability: "High (for tretinoin, adapalene, tazarotene in specific indications).",
            premiumness: "Stability of active, advanced delivery systems (e.g., encapsulated retinol, microsphere tretinoin), research into receptor selectivity."
        },
        "Azelaic Acid": {
            mechanism: [
                "Competitively inhibits tyrosinase, more selective for hyperactive/abnormal melanocytes.",
                "Inhibits mitochondrial enzymes and DNA synthesis in abnormal melanocytes.",
                "Anti-keratinizing (comedolytic) effects.",
                "Anti-inflammatory and antioxidant properties."
            ],
            chemical: [
                "Naturally occurring dicarboxylic acid ($C_9H_{16}O_4$).",
                "Modest percutaneous absorption; formulation (gels better than creams) and pH affect penetration.",
                "Nanoformulations (liposomes, ethosomes) enhance delivery."
            ],
            efficacy: "Effective for melasma, PIH (especially acne/rosacea-related), and acne. Considered gentle with good long-term safety. Improvement is gradual. Comparable to hydroquinone 2-4% in some melasma studies.",
            clinical: {
                indications: "Melasma, PIH, acne, rosacea.",
                side_effects: "Generally well-tolerated. Mild, transient stinging, burning, itching, or dryness, especially initially. Hypopigmentation is rare due to selectivity.",
                contraindications: "Known hypersensitivity.",
                safety: "Considered safe for long-term use and during pregnancy (Category B)."
            },
            speed: "Gradual; several weeks to months.",
            reliability: "Moderate to High.",
            premiumness: "Formulation for enhanced penetration and stability, sourcing of high-purity AZA."
        },
        "Kojic Acid": {
            mechanism: [
                "Potent tyrosinase inhibitor by chelating copper ions at the enzyme's active site.",
                "May inhibit dopachrome tautomerization.",
                "Antioxidant and anti-inflammatory effects."
            ],
            chemical: [
                "Fungal metabolite ($C_6H_6O_4$).",
                "Limited oil solubility. Susceptible to degradation (light, heat, air - browning).",
                "Ester derivatives (e.g., Kojic Dipalmitate) are more stable and lipophilic for better penetration."
            ],
            efficacy: "Effective for skin lightening, often used in combination. Results can be seen in weeks. Efficacy similar to other tyrosinase inhibitors, but stability can be an issue with pure kojic acid.",
            clinical: {
                indications: "Melasma, solar lentigines, general hyperpigmentation.",
                side_effects: "Contact dermatitis, skin sensitization, redness, irritation. Concerns about photostability/photo-damage and historical mutagenicity concerns (low risk at cosmetic levels).",
                contraindications: "Allergy to kojic acid.",
                safety: "CIR: Safe up to 1% in leave-on cosmetics. Some data up to 2%. Restricted in some regions. Use with sunscreen."
            },
            speed: "Weeks to a few months.",
            reliability: "Moderate (stability and sensitization can be issues).",
            premiumness: "Use of stable derivatives (e.g., kojic dipalmitate), advanced formulation for stability and penetration."
        },
        "Arbutin": {
            mechanism: [
                "Tyrosinase inhibitor (competitive). Alpha-arbutin often considered more potent/stable than Beta-arbutin.",
                "Can hydrolyze to hydroquinone in vitro/vivo, contributing to effects.",
                "May inhibit melanosome maturation. Antioxidant properties."
            ],
            chemical: [
                "Naturally occurring glycosylated hydroquinone (Alpha- and Beta- forms).",
                "Hydrophilic; limited skin penetration. Advanced delivery systems (nanoparticles, liposomes) improve this.",
                "Stability concern: hydrolysis to HQ. Alpha-arbutin is generally more stable."
            ],
            efficacy: "Considered a gentler alternative to hydroquinone. Effective for skin lightening. Alpha-arbutin may show results faster or be more potent. Improvement is gradual.",
            clinical: {
                indications: "General hyperpigmentation, melasma, lentigines.",
                side_effects: "Generally well-tolerated. Rare dermatitis/allergic reactions. Concerns about hydroquinone release if not formulated/stored properly.",
                contraindications: "Allergy.",
                safety: "SCCS: Alpha-arbutin safe up to 2% (face), 0.5% (body); Beta-arbutin up to 7% (face) with HQ <1ppm. Deoxyarbutin deemed unsafe by SCCS."
            },
            speed: "Gradual; weeks to months.",
            reliability: "Moderate to High (Alpha-arbutin often preferred).",
            premiumness: "Use of Alpha-arbutin, stabilization technologies, advanced delivery systems."
        },
        "Niacinamide": {
            mechanism: [
                "Inhibits melanosome transfer from melanocytes to keratinocytes (primary mechanism for pigmentation).",
                "Anti-inflammatory, antioxidant effects.",
                "Enhances skin barrier function (increases ceramides, FAs, proteins).",
                "Does NOT inhibit tyrosinase directly."
            ],
            chemical: [
                "Amide form of Vitamin B3. Water-soluble.",
                "Relatively stable (pH 3-7.5). Can hydrolyze to nicotinic acid at very low/high pH (causes flushing).",
                "Penetration can be enhanced by certain formulation excipients."
            ],
            efficacy: "Effective for various types of hyperpigmentation, redness, and improving overall skin health. Results are gradual. Particularly good for PIH due to anti-inflammatory action. Works well in combination.",
            clinical: {
                indications: "Hyperpigmentation (melasma, PIH), acne, rosacea, skin barrier repair, anti-aging.",
                side_effects: "Generally very well-tolerated. Rare mild redness or irritation, especially at high concentrations (>5-10%).",
                contraindications: "Known hypersensitivity.",
                safety: "Very safe for long-term use. Suitable for most skin types, including sensitive skin. Often used at 2-5%, up to 10%."
            },
            speed: "Gradual; 4-8 weeks or longer.",
            reliability: "High.",
            premiumness: "High purity, formulation to avoid hydrolysis to nicotinic acid, synergistic combinations."
        },
        "Vitamin C": {
            mechanism: [
                "Potent antioxidant (scavenges ROS).",
                "Inhibits tyrosinase by interacting with copper ions.",
                "Reduces dopaquinone back to L-DOPA.",
                "Essential for collagen synthesis. Anti-inflammatory."
            ],
            chemical: [
                "L-Ascorbic Acid (LAA) is the most active but highly unstable (oxidizes easily - light, air, heat). Requires low pH (<3.5) for penetration and stability.",
                "Derivatives (MAP, SAP, Ascorbyl Glucoside, EAC, THDA) are more stable, may have better penetration or less irritation, but must convert to LAA in skin (variable efficiency)."
            ],
            efficacy: "LAA is effective for hyperpigmentation and anti-aging when properly formulated. Results depend on form, concentration, pH, and stability. Often combined with Vitamin E and Ferulic Acid for enhanced stability and synergistic antioxidant effects.",
            clinical: {
                indications: "Hyperpigmentation, photoaging, dullness, photoprotection (adjunct to sunscreen).",
                side_effects: "LAA can cause irritation, stinging, redness, especially at high concentrations and low pH. Derivatives are generally better tolerated.",
                contraindications: "Allergy. Caution with very sensitive skin for LAA.",
                safety: "Proper formulation is key for LAA efficacy and minimizing irritation. Derivatives offer stability but may be less potent. Use with sunscreen."
            },
            speed: "Gradual; weeks to months.",
            reliability: "High (for well-formulated LAA or effective derivatives).",
            premiumness: "Stabilization of LAA, use of effective and stable derivatives, optimal pH and concentration, synergistic antioxidant combinations (e.g., CE Ferulic)."
        },
        "Licorice Extract": {
            mechanism: [
                "Glabridin (isoflavonoid) is a potent tyrosinase inhibitor.",
                "Antioxidant and anti-inflammatory (glabridin, isoliquiritigenin, licochalcone A).",
                "Liquiritin (flavonoid) may disperse existing melanin."
            ],
            chemical: [
                "Complex botanical extract (*Glycyrrhiza* sp.). Contains multiple bioactives.",
                "Glabridin is hydrophobic, low water solubility, poor permeability. Isoliquiritigenin levels can be increased by heat processing.",
                "Formulation challenges for stability and penetration of key actives (e.g., glabridin). Nanoemulsions or other carriers can help."
            ],
            efficacy: "Shows promise for skin lightening and anti-inflammatory benefits. Efficacy depends on extract quality, concentration of active compounds (especially glabridin), and formulation. Variability is a challenge.",
            clinical: {
                indications: "Hyperpigmentation, PIH, sensitive/inflamed skin.",
                side_effects: "Generally well-tolerated. Rare allergic contact dermatitis (especially with oil-soluble extracts). Concerns about standardization and potential impurities.",
                contraindications: "Allergy.",
                safety: "Used at low concentrations in cosmetics (0.0001-0.5%). Higher concentrations for therapeutic effects. CIR notes potential for pesticide/heavy metal residues."
            },
            speed: "Variable; weeks to months.",
            reliability: "Moderate (due to variability in extracts and formulation challenges).",
            premiumness: "Standardized extracts with high levels of active compounds (e.g., glabridin), advanced delivery systems for actives."
        },
        "Tranexamic Acid": {
            mechanism: [
                "Inhibits UV-induced plasmin activity in keratinocytes (primary mechanism). This reduces production of melanocyte stimulators (prostaglandins, Î±-MSH).",
                "Anti-inflammatory and anti-angiogenic effects (reduces VEGF).",
                "May inhibit PAR-2 activation (involved in melanosome transfer).",
                "Weak/secondary direct tyrosinase inhibition is less clear."
            ],
            chemical: [
                "Synthetic lysine derivative. Hydrophilic, limiting topical penetration.",
                "Ester derivatives (e.g., Cetyl Tranexamate Mesylate, TXVectorâ¢) are lipophilic prodrugs for better penetration, releasing TXA in skin.",
                "Can be used topically, orally, or via intradermal injection."
            ],
            efficacy: "Increasingly recognized for melasma and PIH. Effective both topically and orally. Topical results are gradual. Oral use can be very effective but has more systemic considerations.",
            clinical: {
                indications: "Melasma (especially with vascular component), PIH, rosacea-associated redness.",
                side_effects: "Topical: Generally well-tolerated; mild irritation, dryness possible. Oral: GI upset, menstrual changes, very rare risk of thrombosis (contraindicated in those with risk factors).",
                contraindications: "Oral: History of thromboembolic disease, certain coagulation disorders. Topical: Allergy.",
                safety: "Topical is safe for most. Oral requires medical evaluation. Concentrations for topical: 2-5%."
            },
            speed: "Gradual; 8-12 weeks or more for topical.",
            reliability: "Moderate to High (especially for melasma).",
            premiumness: "Use of lipophilic ester prodrugs for enhanced topical delivery, formulation for stability."
        },
        "Alpha Hydroxy Acids (AHAs)": {
            mechanism: [
                "Exfoliation/desquamation by reducing corneocyte cohesion (primary).",
                "Stimulate cell turnover.",
                "Glycolic acid may directly inhibit tyrosinase (emerging evidence).",
                "Increase hyaluronic acid and collagen (glycolic).",
                "Enhance penetration of other actives."
            ],
            chemical: [
                "e.g., Glycolic Acid (smallest, from sugar cane), Lactic Acid (gentler, from milk).",
                "Water-soluble. Efficacy is pH-dependent (most effective at low pH <4.0).",
                "Glycolic acid penetrates well due to small size. Lactic acid is larger, more hydrating."
            ],
            efficacy: "Effective for improving skin texture, reducing superficial hyperpigmentation, and enhancing radiance. Higher concentrations (peels) provide more dramatic results. Glycolic and lactic acids are well-studied.",
            clinical: {
                indications: "Superficial hyperpigmentation, dullness, uneven texture, photoaging. Used in daily products (2-10%) and professional peels (20-70%).",
                side_effects: "Irritation, redness, stinging, peeling, sun sensitivity. Depends on concentration, pH, frequency, and skin type. Lactic acid is generally gentler.",
                contraindications: "Very sensitive skin, active infections, recent procedures (for peels).",
                safety: "Sun protection is crucial as AHAs increase sun sensitivity. Proper formulation pH is key. Patch test recommended."
            },
            speed: "Daily use: Weeks for texture, longer for pigment. Peels: Faster results.",
            reliability: "High (for exfoliation and texture).",
            premiumness: "Proper pH formulation, buffering for reduced irritation, combination with soothing agents."
        },
         "Beta Hydroxy Acids (BHAs)": {
            mechanism: [
                "Exfoliation/desmolytic action by disrupting corneodesmosomes.",
                "Lipid-soluble, penetrates pores (comedolytic effect).",
                "Anti-inflammatory properties.",
                "May reduce sebum secretion."
            ],
            chemical: [
                "Salicylic Acid (SA) is the main BHA.",
                "Oil-soluble. Slightly soluble in water, soluble in alcohols.",
                "Stable in formulations."
            ],
            efficacy: "Highly effective for acne and oily skin due to pore penetration. Good for PIH associated with acne. Exfoliates surface pigmentation. Less directly focused on tyrosinase inhibition compared to other agents.",
            clinical: {
                indications: "Acne, comedones, oily skin, PIH (especially acne-related), superficial pigmentation. Used in OTC products (0.5-2%) and peels (up to 30%+).",
                side_effects: "Dryness, peeling, irritation, redness. Generally well-tolerated at OTC levels. Salicylism is rare with topical use.",
                contraindications: "Aspirin allergy (as SA is related). Caution in pregnancy (systemic absorption concern with high doses/large areas, though low risk with topical use).",
                safety: "Effective for targeted concerns. Sun protection recommended."
            },
            speed: "Weeks for acne improvement and surface exfoliation.",
            reliability: "High (for acne and exfoliation).",
            premiumness: "Formulation for effective delivery and minimized irritation, e.g., timed-release or buffered systems."
        },
        "Thiamidol": {
            mechanism: [
                "Highly potent and specific inhibitor of human tyrosinase (reversible).",
                "Blocks conversion of tyrosine to melanin.",
                "Prevents UV-induced hyperpigmentation."
            ],
            chemical: [
                "Isobutylamido Thiazolyl Resorcinol ($C_{13}H_{14}N_2O_3S$).",
                "Patented resorcinol-thiazole derivative (Eucerin/Beiersdorf).",
                "Formulated in creams/serums (0.1-0.2%). Details on solubility/penetration enhancers not widely public but clinical efficacy implies good delivery."
            ],
            efficacy: "Clinically proven to be very effective for reducing various types of hyperpigmentation (melasma, age spots, PIH). Visible results often reported within 2-4 weeks, with continued improvement. High potency against human tyrosinase.",
            clinical: {
                indications: "Melasma, solar lentigines (age spots), PIH, general hyperpigmentation.",
                side_effects: "Reported to be very gentle and well-tolerated, even on sensitive skin. Infrequent, minor transient skin irritation.",
                contraindications: "Known hypersensitivity.",
                safety: "Considered safe and effective for all skin types and tones. Recommended for daily use. Sun protection essential."
            },
            speed: "Relatively fast; noticeable results often in 2-4 weeks.",
            reliability: "High (strong clinical data for efficacy and tolerability).",
            premiumness: "Patented ingredient, novelty, high research investment, specificity for human tyrosinase."
        },
        "Hexylresorcinol": {
            mechanism: [
                "Potent tyrosinase inhibitor.",
                "May inhibit peroxidase.",
                "Antioxidant effects, protects against DNA damage.",
                "Stimulates glutathione synthesis (enhances antioxidant defense)."
            ],
            chemical: [
                "Synthetic alkylresorcinol.",
                "Generally considered stable. Lipophilic nature may aid penetration."
            ],
            efficacy: "Demonstrated skin-lightening effects, comparable or superior to hydroquinone at similar concentrations in some studies, but with better tolerability. Also offers anti-aging benefits (collagen stimulation, antioxidant).",
            clinical: {
                indications: "Hyperpigmentation, uneven skin tone, anti-aging.",
                side_effects: "Generally well-tolerated. Lower irritation potential compared to hydroquinone. Possible mild irritation in sensitive individuals.",
                contraindications: "Known hypersensitivity.",
                safety: "Considered a safe and effective alternative to hydroquinone. Often used in concentrations around 0.5% to 2%."
            },
            speed: "Gradual; weeks to months.",
            reliability: "Moderate to High.",
            premiumness: "Multi-functional benefits (lightening, antioxidant, anti-aging), GRAS status for some uses, research into efficacy and tolerability."
        },
        "Cysteamine": {
            mechanism: [
                "Inhibits tyrosinase and peroxidase.",
                "Scavenges dopaquinone.",
                "Increases intracellular glutathione (antioxidant, shifts melanogenesis towards pheomelanin).",
                "Chelates copper and iron ions involved in melanogenesis."
            ],
            chemical: [
                "Naturally occurring aminothiol compound (metabolite of L-cysteine).",
                "Has a characteristic sulfurous odor, which is a formulation challenge.",
                "Stability can be an issue; often formulated as Cysteamine Hydrochloride."
            ],
            efficacy: "Shown to be effective for melasma and other hyperpigmentation, comparable to Kligman's formula in some studies but with fewer side effects. Requires a specific application protocol (short contact therapy initially).",
            clinical: {
                indications: "Melasma, PIH, lentigines.",
                side_effects: "Characteristic sulfurous odor. Transient redness, dryness, irritation, especially early in treatment. These usually subside. Hypopigmentation not typically reported.",
                contraindications: "Pregnancy, lactation, vitiligo history (theoretical concerns). Allergy.",
                safety: "Generally safe when used as directed (e.g., 15-minute application then wash off). Odor and initial irritation are main compliance challenges. Non-cytotoxic."
            },
            speed: "Initial results in 6-8 weeks, significant improvement by 12-16 weeks.",
            reliability: "Moderate to High.",
            premiumness: "Formulation to mask odor and improve stability, unique short-contact application protocol, research supporting efficacy comparable to gold standards."
        }
    };

    const glossaryData = {
        "Achromia": "Complete absence of normal melanin pigment, resulting in white skin. Synonymous with Leukoderma.",
        "Crusting": "Dried exudate (serum, blood, or pus) on the skin surface.",
        "Dyschromia": "Any abnormality or alteration in skin color (hyper-, hypo-, or unusual color).",
        "Erythema": "Redness of the skin caused by vasodilation; blanches with pressure. Different from true pigmentation.",
        "Excoriation": "Superficial loss of epidermis due to scratching or picking; can lead to PIH.",
        "Hyperpigmentation": "Skin darker than normal surrounding skin due to excess melanin or other pigments.",
        "Hypopigmentation": "Skin paler than normal due to partial loss of melanin.",
        "Lesion": "Any single, localized area of altered or abnormal skin.",
        "Leukoderma": "White skin due to complete loss of melanin. Synonymous with Achromia.",
        "Lichenification": "Palpable thickening of skin with accentuated skin markings from chronic rubbing.",
        "Macule": "A flat, circumscribed area of color change, <1-1.5 cm in diameter.",
        "Melanocyte": "Specialized cell in the basal layer of the epidermis responsible for producing melanin.",
        "Melanogenesis": "The biochemical process of melanin production within melanocytes.",
        "Melanosome": "Organelle within melanocytes where melanin is synthesized and stored.",
        "Melanosis": "Excessive deposition of melanin in tissues, particularly skin or mucous membranes.",
        "Patch": "A flat area of skin color change, >1-1.5 cm in diameter.",
        "PIH (Post-Inflammatory Hyperpigmentation)": "Acquired hypermelanosis following cutaneous inflammation or injury.",
        "Solar Lentigines": "Benign hyperpigmented macules (sun spots, age spots) due to chronic UV exposure.",
        "Stratum Corneum": "Outermost layer of the epidermis, composed of dead keratinocytes; acts as a barrier.",
        "Tyrosinase": "The key, rate-limiting enzyme in the melanin synthesis pathway."
    };

    let potencyChartInstance = null;

    document.addEventListener('DOMContentLoaded', function() {
        const navElement = document.querySelector('nav');
        const contentSections = document.querySelectorAll('.content-section');
        const ingredientButtonsContainer = document.getElementById('ingredientButtons');
        const ingredientDetailContainer = document.getElementById('ingredientDetail');
        const categorizationTableBody = document.getElementById('categorizationTableBody');
        const glossaryContentContainer = document.getElementById('glossaryContent');

        const getAIRoutineBtn = document.getElementById('getAIRoutineBtn');
        const aiLoadingSpinner = document.getElementById('aiLoadingSpinner');
        const aiRoutineResult = document.getElementById('aiRoutineResult');
        const aiSkinType = document.getElementById('aiSkinType');
        const aiConcern = document.getElementById('aiConcern');
        const aiAvoidIngredients = document.getElementById('aiAvoidIngredients');

        const burgerMenuButton = document.getElementById('burger-menu-button');
        const mobileMenuPanel = document.getElementById('mobile-menu-panel');
        
        const getStartedBtn = document.getElementById('get-started-btn');
        const getStartedBtnMobile = document.getElementById('get-started-btn-mobile');
        const consultationModal = document.getElementById('get-started-modal');
        const consultationModalContent = consultationModal ? consultationModal.querySelector('.modal-content') : null;
        const closeModalBtn = document.getElementById('close-modal');
        const skinConsultationForm = document.getElementById('skin-consultation-form');
        const recommendationOutput = document.getElementById('recommendation-output');

        function setDynamicOffsets() {
            if (navElement) {
                const navHeight = navElement.offsetHeight;
                document.documentElement.style.scrollPaddingTop = `${navHeight + 20}px`; 
                document.body.style.paddingTop = `${navHeight}px`;
            }
        }
        
        setDynamicOffsets(); 
        window.addEventListener('resize', setDynamicOffsets); 
        window.addEventListener('scroll', function() { 
            setDynamicOffsets(); // Recalculate on scroll in case of dynamic changes
            let currentActive = 'home'; 
            const navHeight = navElement ? navElement.offsetHeight : 0;
            const scrollPosition = window.pageYOffset;

            contentSections.forEach(section => {
                // Consider a section active if its top is within a certain range of the viewport top
                // Or if a significant portion of it is visible
                const sectionTop = section.offsetTop - navHeight - 50; // Adjusted offset for better accuracy
                const sectionBottom = sectionTop + section.offsetHeight;
                
                // If the top of the section is above the scroll position and bottom is below, it's likely the current one
                if (scrollPosition >= sectionTop && scrollPosition < sectionBottom - (section.offsetHeight * 0.3)) { // Active if top 70% is visible
                    currentActive = section.id;
                }
            });
            
            // Fallback for very top of the page
            if (scrollPosition < (document.getElementById('understanding')?.offsetTop - navHeight - 100 || 200)) { 
                 currentActive = 'home';
            }

            document.querySelectorAll('nav a.nav-button').forEach(link => {
                link.classList.toggle('active', link.dataset.target === currentActive);
            });
        });

        function initializePotencyChart() {
            if (potencyChartInstance) {
                potencyChartInstance.destroy(); 
            }
            const potencyChartCanvas = document.getElementById('potencyChart');
            if (potencyChartCanvas && potencyChartCanvas.offsetParent !== null) { 
                const ctx = potencyChartCanvas.getContext('2d');
                Chart.defaults.color = '#CBD5E1'; // slate-300
                Chart.defaults.borderColor = 'rgba(107, 114, 128, 0.25)'; 
                Chart.defaults.font.family = "'Josefin Sans', sans-serif"; // Use Josefin Sans for chart text

                potencyChartInstance = new Chart(ctx, { 
                    type: 'bar',
                    data: {
                        labels: ['Thiamidol', 'Kojic Acid', 'Hydroquinone'],
                        datasets: [{
                            label: 'IC50 (Âµmol/L) vs Human Tyrosinase (Lower is More Potent)',
                            data: [1.1, 500, 4000],
                            backgroundColor: ['rgba(110, 231, 183, 0.7)', 'rgba(107, 114, 128, 0.7)', 'rgba(75, 85, 99, 0.7)'], 
                            borderColor: ['#6EE7B7', '#6B7280', '#4B5563'],
                            borderWidth: 1,
                            borderRadius: 4, // Rounded bars
                        }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        scales: {
                            y: { 
                                beginAtZero: true, 
                                type: 'logarithmic', 
                                title: { display: true, text: 'IC50 (Âµmol/L) - Logarithmic Scale', color: '#E2E8F0', font: {size: 13}}, // slate-200
                                grid: { color: 'rgba(107, 114, 128, 0.2)' },
                                ticks: { color: '#CBD5E1', font: {size: 11} } // slate-300
                            },
                            x: { 
                                title: { display: true, text: 'Ingredient', color: '#E2E8F0', font: {size: 13}},
                                grid: { display: false }, 
                                ticks: { color: '#CBD5E1', font: {size: 12} }
                            }
                        },
                        plugins: {
                            tooltip: {
                                backgroundColor: 'rgba(30, 41, 59, 0.9)', // slate-800
                                titleColor: '#F1F5F9', // slate-100
                                bodyColor: '#CBD5E1', // slate-300
                                titleFont: { family: "'Outfit', sans-serif", weight: '600'},
                                bodyFont: { family: "'Josefin Sans', sans-serif"},
                                padding: 10,
                                cornerRadius: 4,
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) label += ': ';
                                        if (context.parsed.y !== null) label += context.parsed.y + ' Âµmol/L';
                                        if (context.label === 'Kojic Acid' || context.label === 'Hydroquinone') label += ' (approx. or > value)';
                                        return label;
                                    }
                                }
                            },
                            legend: { display: false }
                        }
                    }
                });
            }
        }

        function showSection(targetId, smooth = false) {
            document.querySelectorAll('nav a.nav-button').forEach(link => {
                link.classList.toggle('active', link.dataset.target === targetId);
            });
            
            contentSections.forEach(section => {
                section.classList.toggle('active', section.id === targetId);
            });

            if (targetId === 'ingredients') {
                setTimeout(initializePotencyChart, 100); // Shorter delay
            }

            if (!smooth && targetId === 'home') { 
                 window.scrollTo({top: 0, behavior: 'auto'});
            }
        }

        function handleNavLinkClick(event) {
            event.preventDefault(); 
            const targetId = this.dataset.target;
            const targetSection = document.getElementById(targetId);
            
            if (targetSection) {
                const navHeight = navElement ? navElement.offsetHeight : 0;
                let scrollTargetPosition = targetSection.offsetTop - navHeight - 20; 
                
                if (targetId === 'home') { 
                    scrollTargetPosition = 0; 
                }
                
                window.scrollTo({
                    top: scrollTargetPosition,
                    behavior: 'smooth'
                });
                
                showSection(targetId, true); 

                if (mobileMenuPanel && !mobileMenuPanel.classList.contains('hidden')) {
                    mobileMenuPanel.classList.add('hidden');
                }
            }
        }

        document.querySelectorAll('#desktop-nav-links a.nav-button').forEach(link => {
            link.addEventListener('click', handleNavLinkClick);
        });
        document.querySelectorAll('#mobile-menu-panel a.nav-button').forEach(link => {
            link.addEventListener('click', handleNavLinkClick);
        });

        if (burgerMenuButton && mobileMenuPanel) {
            burgerMenuButton.addEventListener('click', function() {
                mobileMenuPanel.classList.toggle('hidden');
            });
        }

        function openModal(modalElement, modalContentElement) {
            if (!modalElement || !modalContentElement) return;
            modalElement.style.display = "block";
            // Trigger reflow for transition
            modalElement.offsetHeight; 
            modalElement.classList.add('active');
        }

        function closeModal(modalElement) {
            if (!modalElement) return;
            modalElement.classList.remove('active');
            // Wait for transition to finish before hiding
            setTimeout(() => {
                modalElement.style.display = "none";
                if (recommendationOutput) recommendationOutput.innerHTML = ""; 
            }, 300); // Match transition duration
        }

        if (getStartedBtn && consultationModal && consultationModalContent) {
            getStartedBtn.onclick = function(e) {
                e.preventDefault();
                openModal(consultationModal, consultationModalContent);
            }
        }
        if (getStartedBtnMobile && consultationModal && consultationModalContent) {
             getStartedBtnMobile.onclick = function(e) {
                e.preventDefault();
                openModal(consultationModal, consultationModalContent);
                if (mobileMenuPanel && !mobileMenuPanel.classList.contains('hidden')) {
                    mobileMenuPanel.classList.add('hidden');
                }
            }
        }
        if (closeModalBtn && consultationModal) {
            closeModalBtn.onclick = function() {
                closeModal(consultationModal);
            }
        }
        if (consultationModal) {
            window.onclick = function(event) {
                if (event.target == consultationModal) {
                    closeModal(consultationModal);
                }
            }
        }
        
        if (skinConsultationForm) {
            skinConsultationForm.onsubmit = function(event) {
                event.preventDefault();
                const hyperpigmentationType = document.getElementById('hyperpigmentation-type').value;
                const skinType = document.getElementById('skin-type').value;
                const sensitivity = document.getElementById('sensitivity').value;
                const currentRoutine = document.getElementById('current-routine').value;
                const medicalHistory = document.getElementById('medical-history').value;

                if (medicalHistory !== 'none') {
                    recommendationOutput.innerHTML = `
                        <h3 class="text-xl font-semibold mb-3">Important Note:</h3>
                        <p>Thank you for providing your information. Due to the complexities of medical history and medication interactions, we strongly recommend contacting us directly for a more personalized consultation or speaking with a dermatologist.</p>
                        <p class="mt-3">You can reach us on <a href="YOUR_FACEBOOK_LINK_HERE" target="_blank" class="text-sky-400 hover:underline">Facebook</a> or <a href="YOUR_INSTAGRAM_LINK_HERE" target="_blank" class="text-pink-400 hover:underline">Instagram</a>.</p>
                    `;
                } else {
                    const recommendations = getIngredientRecommendations(hyperpigmentationType, skinType, sensitivity, currentRoutine, medicalHistory);
                    recommendationOutput.innerHTML = `
                        <h3>Our Suggestion:</h3>
                        <p>${recommendations}</p>
                        <p class="text-xs mt-3 text-gray-500">Note: This is a general suggestion. For personalized advice, please consult a dermatologist.</p>
                    `;
                }
            };
        }

        function getIngredientRecommendations(hyperpigmentationType, skinType, sensitivity, currentRoutine, medicalHistory) {
            let suggested = [];
            if (hyperpigmentationType === 'melasma') {
                suggested.push("Azelaic Acid", "Niacinamide", "Tranexamic Acid");
                if (sensitivity !== 'retinoid-sensitive') {
                    suggested.push("Low-strength Retinoid (start slow)");
                }
            } else if (hyperpigmentationType === 'pih') {
                suggested.push("Niacinamide", "Vitamin C", "Azelaic Acid", "Licorice Extract");
            } else if (hyperpigmentationType === 'solar-lentigines') {
                 suggested.push("Vitamin C", "Retinoids", "AHAs (e.g., Glycolic Acid)");
            } else { 
                suggested.push("Niacinamide", "Vitamin C", "Licorice Extract", "Azelaic Acid (gentle option)");
            }

            if (sensitivity === 'eczema-prone' || sensitivity === 'rosacea-prone' || sensitivity === 'aha-bha-sensitive') {
                suggested = suggested.filter(ing => !ing.includes("AHA") && !ing.includes("BHA") && !ing.toLowerCase().includes("retinoid"));
                suggested.push("Bakuchiol (gentle retinoid alternative if needed and tolerated)");
            }
            
            suggested = [...new Set(suggested)]; 

            if (suggested.length > 0) {
                return "Consider incorporating products with: " + suggested.join(', ') + ". Always patch test new ingredients and introduce them one at a time. Sunscreen (SPF 30+) daily is crucial.";
            } else {
                return "Based on your selections, it's best to consult a dermatologist for tailored advice.";
            }
        }

        Object.keys(ingredientData).forEach(name => {
            const button = document.createElement('button');
            let buttonClasses = 'ingredient-button py-2 px-2.5 rounded-md text-center'; 
            
            if (name.length > 15) { 
                buttonClasses += ' whitespace-normal leading-tight text-xs sm:text-sm'; // Smaller text for long names
            } else {
                buttonClasses += ' whitespace-nowrap text-sm'; 
            }
            
            button.className = buttonClasses;
            button.textContent = name;
            button.dataset.ingredient = name;

            button.addEventListener('click', function() {
                displayIngredientDetails(name);
                document.querySelectorAll('#ingredientButtons .ingredient-button').forEach(btn => btn.classList.remove('selected'));
                this.classList.add('selected');
            });
            if (ingredientButtonsContainer) ingredientButtonsContainer.appendChild(button);

            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${name}</td>
                <td>${ingredientData[name].speed || 'Variable'}</td>
                <td>${ingredientData[name].reliability || 'Variable'}</td>
                <td>${ingredientData[name].premiumness || 'N/A'}</td>
            `;
            if (categorizationTableBody) categorizationTableBody.appendChild(tr);
        });
        
        function displayIngredientDetails(name) {
            const data = ingredientData[name];
            if (!data || !ingredientDetailContainer) {
                if (ingredientDetailContainer) ingredientDetailContainer.innerHTML = `<p class="text-gray-400 italic">Details not found for ${name}.</p>`;
                return;
            }

            let html = `<h3>${name}</h3>`;
            if (data.mechanism) {
                html += `<h4>Mechanism of Action:</h4><ul class="list-disc list-inside space-y-1">`;
                data.mechanism.forEach(item => html += `<li>${item}</li>`);
                html += `</ul>`;
            }
            if (data.chemical) {
                html += `<h4>Chemical Properties:</h4><ul class="list-disc list-inside space-y-1">`;
                data.chemical.forEach(item => html += `<li>${item}</li>`);
                html += `</ul>`;
            }
            if (data.efficacy) {
                html += `<h4>Efficacy Summary:</h4><p>${data.efficacy}</p>`;
            }
            if (data.clinical) {
                html += `<h4>Clinical Profile:</h4><div class="space-y-1.5">`; // Adjusted spacing
                if(data.clinical.indications) html += `<p><strong>Indications:</strong> ${data.clinical.indications}</p>`;
                if(data.clinical.side_effects) html += `<p><strong>Potential Side Effects:</strong> ${data.clinical.side_effects}</p>`;
                if(data.clinical.contraindications) html += `<p><strong>Contraindications:</strong> ${data.clinical.contraindications}</p>`;
                if(data.clinical.safety) html += `<p><strong>General Safety Considerations:</strong> ${data.clinical.safety}</p></div>`;
            }
            ingredientDetailContainer.innerHTML = html;
            ingredientDetailContainer.classList.remove('hidden'); 
        }

        const sortedGlossaryKeys = Object.keys(glossaryData).sort();
        sortedGlossaryKeys.forEach(term => {
            const termDiv = document.createElement('div');
            termDiv.innerHTML = `<p><strong class="glossary-term">${term}:</strong> ${glossaryData[term]}</p>`;
            if (glossaryContentContainer) glossaryContentContainer.appendChild(termDiv);
        });
        
        const observerOptions = { root: null, rootMargin: '0px', threshold: 0.1 };
        const observer = new IntersectionObserver((entries, obs) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                } else {
                    // Optional: remove visible class if you want fade-out on scroll away
                    // entry.target.classList.remove('visible');
                }
            });
        }, observerOptions);
        document.querySelectorAll('.content-section').forEach(section => { 
            section.classList.add('scroll-fade-in'); 
            observer.observe(section);
        });
        
        if (getAIRoutineBtn) {
            getAIRoutineBtn.addEventListener('click', async () => {
                const skinType = aiSkinType.value;
                const concern = aiConcern.value;
                const avoid = aiAvoidIngredients.value.trim();

                aiRoutineResult.innerHTML = ''; 
                aiRoutineResult.classList.add('hidden'); 

                aiLoadingSpinner.classList.remove('hidden');
                getAIRoutineBtn.disabled = true;
                
                aiRoutineResult.innerHTML = '<div class="p-4 md:p-6 text-gray-300 italic">â¨ Generating your personalized routine suggestion...</div>';
                aiRoutineResult.classList.remove('hidden');

                let prompt = `You are an expert skincare formulation chemist and dermatologist. Based on the following user information, suggest a simple daily (morning and evening) skincare routine to help with their pigmentation concern.
User Skin Type: ${skinType}
Primary Pigmentation Concern: ${concern}
`;
                if (avoid) {
                    prompt += `Ingredients to avoid or currently using: ${avoid}\n`;
                }
                prompt += `
The routine should focus on addressing the pigmentation concern while being suitable for the user's skin type.
Suggest general product types (e.g., "gentle cleanser", "hydrating serum with Niacinamide", "broad-spectrum SPF 50 sunscreen etc.") rather than specific brands.
If possible, incorporate some of these known effective ingredients for pigmentation, ensuring they are appropriate for the skin type and concern: ${Object.keys(ingredientData).join(', ')}.
Provide the routine in a clear, step-by-step format for morning and evening. Use markdown for formatting, like using '###' for main routine headers (Morning/Evening/Notes), '####' for step headers (e.g., Cleanse, Treat), '*' for bullet points and '**' for bold. Make the response concise, easy to understand, and actionable.
Always add at last "powered by Gemini-2.0"


Example Output Format:
### Morning Routine
#### **Step 1: Cleanse** * Use a gentle, hydrating cleanser.
#### **Step 2: Treat** * Apply an antioxidant serum (like Vitamin C).
#### **Step 3: Moisturize** * Use a lightweight, non-comedogenic moisturizer.
#### **Step 4: Protect** * Apply a broad-spectrum sunscreen with SPF 50+.

### Evening Routine
#### **Step 1: Cleanse** * Gently cleanse the skin.
#### **Step 2: Treat** * Apply a treatment serum (e.g., with Niacinamide or Azelaic Acid).
#### **Step 3: Moisturize** * Use a suitable moisturizer.

### Important Notes
* **Sunscreen is non-negotiable.** It's the most critical step to prevent further pigmentation.
* **Introduce new active ingredients slowly** (e.g., 2-3 times a week initially) to assess tolerance.
* **Consistency is key** to seeing results.
__powered by Gemini-2.0__
`;

                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = "AIzaSyBnlG3i_BSah-Xq4iRk6cBZhIUqgQYW9yU"; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        console.error("API Error:", errorData);
                        let errorMessage = `API request failed with status ${response.status}`;
                        if (errorData.error && errorData.error.message) {
                            errorMessage += `: ${errorData.error.message}`;
                        }
                        throw new Error(errorMessage);
                    }

                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        let text = result.candidates[0].content.parts[0].text;
                        
                        text = text.replace(/</g, "&lt;").replace(/>/g, "&gt;"); 
                        text = text.replace(/####\s*(.*?)/g, '<h5 class="!mt-4 !mb-2 text-gray-200">$1</h5>'); 
                        text = text.replace(/###\s*(.*)/g, '<h4 class="!mt-6 !mb-3 text-gray-100">$1</h4>'); 
                        text = text.replace(/\*\*\s*(.*?)\s*\*\*/g, '<strong class="text-gray-100">$1</strong>'); 
                        text = text.replace(/^\s*\*\s+(.*)/gm, '<li class="!mb-1.5 text-gray-300">$1</li>'); 
                        text = text.replace(/(<\/h[45]>)(<li>.*?<\/li>)+/g, (match, header, listItems) => {
                            return `${header}<ul class="list-disc list-inside space-y-1 mt-1 mb-2">${listItems.match(/<li>.*?<\/li>/g).join('')}</ul>`;
                        });
                         text = text.replace(/(\n\s*<li>.*?<\/li>)+/g, (match) => {
                            return `<ul class="list-disc list-inside space-y-1 mt-1 mb-2">${match.match(/<li>.*?<\/li>/g).join('')}</ul>`;
                        });


                        aiRoutineResult.innerHTML = `
                            <div class="p-4 md:p-6"> 
                                <h3 class="text-xl font-semibold mb-4 text-gray-100">â¨ Your AI Skincare Routine Suggestion:</h3>
                                <div class="prose-sm sm:prose max-w-none leading-relaxed text-gray-300">
                                    ${text}
                                </div>
                            </div>
                        `;
                        aiRoutineResult.classList.remove('hidden'); 

                    } else {
                        console.error("Unexpected API response structure:", result);
                        aiRoutineResult.innerHTML = '<div class="p-4 md:p-6 text-red-400">Could not retrieve a suggestion. The AI returned an empty response.</div>';
                        aiRoutineResult.classList.remove('hidden');
                    }
                } catch (error) {
                    console.error('Error fetching AI routine:', error);
                    aiRoutineResult.innerHTML = `<div class="p-4 md:p-6 text-red-400">An error occurred while generating your routine: ${error.message}. Please try again later.</div>`;
                    aiRoutineResult.classList.remove('hidden'); 
                } finally {
                    aiLoadingSpinner.classList.add('hidden');
                    getAIRoutineBtn.disabled = false;
                }
            });
        }
        showSection('home', false); 
    });

    function openDisorderTab(event, disorderName) {
        var i, tabcontent, tabbuttons;
        const understandingSection = document.getElementById("understanding");
        if (!understandingSection) return; 
        tabcontent = understandingSection.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
            tabcontent[i].classList.remove("active");
        }
        tabbuttons = understandingSection.getElementsByClassName("tab-button");
        for (i = 0; i < tabbuttons.length; i++) { 
            tabbuttons[i].classList.remove("active");
        }
        const targetTab = document.getElementById(disorderName);
        if (targetTab) {
            targetTab.style.display = "block";
            targetTab.classList.add("active");
        }
        if (event && event.currentTarget) { 
            event.currentTarget.classList.add("active");
        }
    }
</script>
</body>
</html>
